<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Food Menu OTP Login</title>
<style>
  body { font-family: Arial,sans-serif; background:#222; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;}
  .container { background:rgba(0,0,0,0.7); padding:30px; border-radius:15px; width:350px; text-align:center;}
  input, button { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none;}
  button { background:#00eaff; color:#000; cursor:pointer; font-weight:600;}
</style>
</head>
<body>

<div class="container" id="loginBox">
  <h2>Login / Signup</h2>
  <div class="input-group">
    <label>Full Name</label>
    <input type="text" id="fullname" placeholder="Enter your name">
  </div>
  <div class="input-group">
    <label>Phone Number</label>
    <input type="tel" id="phone" placeholder="Enter your phone" maxlength="10">
  </div>
  <div class="input-group" id="otpField" style="display:none;">
    <label>Enter OTP</label>
    <input type="text" id="otpInput" placeholder="Enter OTP">
  </div>
  <button id="sendOTPBtn">Send OTP</button>
  <button id="verifyOTPBtn" style="display:none;">Verify OTP</button>
  <p id="statusMsg"></p>
</div>

<script>
let generatedOTP = null;

// Send OTP
document.getElementById('sendOTPBtn').addEventListener('click', async () => {
  const fullname = document.getElementById('fullname').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const statusMsg = document.getElementById('statusMsg');

  if (!fullname || !phone) {
    statusMsg.textContent = "Please fill all fields";
    statusMsg.style.color = 'red';
    return;
  }

  generatedOTP = Math.floor(100000 + Math.random()*900000).toString();

  try {
    const res = await fetch('/.netlify/functions/send-otp', {
      method: 'POST',
      body: JSON.stringify({ phone, otp: generatedOTP })
    });
    const data = await res.json();

    if (data.success) {
      statusMsg.textContent = "✅ OTP sent to your phone.";
      statusMsg.style.color = 'green';
      document.getElementById('otpField').style.display = 'block';
      document.getElementById('sendOTPBtn').style.display = 'none';
      document.getElementById('verifyOTPBtn').style.display = 'block';
    } else {
      statusMsg.textContent = "❌ Failed to send OTP: " + data.error;
      statusMsg.style.color = 'red';
    }
  } catch (err) {
    statusMsg.textContent = "❌ Error: " + err.message;
    statusMsg.style.color = 'red';
  }
});

// Verify OTP
document.getElementById('verifyOTPBtn').addEventListener('click', () => {
  const enteredOTP = document.getElementById('otpInput').value.trim();
  const statusMsg = document.getElementById('statusMsg');

  if (enteredOTP === generatedOTP) {
    statusMsg.textContent = "✅ OTP verified! Welcome!";
    statusMsg.style.color = 'green';
    document.getElementById('verifyOTPBtn').style.display = 'none';
  } else {
    statusMsg.textContent = "❌ Incorrect OTP. Try again.";
    statusMsg.style.color = 'red';
  }
});
</script>

</body>
</html>
